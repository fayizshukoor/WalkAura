<div class="min-h-screen bg-black flex items-center justify-center p-4">
  <style>
    /* Hide native password toggle in Edge/IE */
    input::-ms-reveal,
    input::-ms-clear {
      display: none;
    }
  </style>

  <div class="w-full max-w-md bg-[#161616] border border-gray-800 rounded-2xl shadow-2xl p-8">
    
    <div class="text-center mb-8">
      <h2 class="text-3xl font-bold text-white tracking-tight">
        Change Password
      </h2>
      </div>

    <%- include('../partials/alerts') %>

    <form class="space-y-6" action="/profile/change-password" method="POST" id="changePasswordForm">
      
      <div>
        <label for="current-password" class="block text-sm font-medium text-gray-400 mb-2">
          Current Password
        </label>
        <div class="relative">
          <input 
            id="current-password" 
            name="currentPassword" 
            type="password"  
            placeholder="Enter your current password"
            class="w-full px-4 py-3 bg-[#1e1e1e] border border-gray-700 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-600 focus:border-transparent text-white placeholder-gray-600 transition-all pr-10"
          >
          <button type="button" onclick="toggleVisibility('current-password', 'eye-icon-current')" class="absolute inset-y-0 right-0 z-10 flex items-center pr-3 text-gray-400 hover:text-white focus:outline-none cursor-pointer">
            <svg id="eye-icon-current" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5">
              <path stroke-linecap="round" stroke-linejoin="round" d="M2.036 12.322a1.012 1.012 0 010-.639C3.423 7.51 7.36 4.5 12 4.5c4.638 0 8.573 3.007 9.963 7.178.07.207.07.431 0 .639C20.577 16.49 16.64 19.5 12 19.5c-4.638 0-8.573-3.007-9.963-7.178z" />
              <path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
            </svg>
          </button>
        </div>
        <div class="flex justify-end mt-2">
          <a href="/forgot-password/authenticated" class="text-xs text-indigo-400 hover:text-indigo-300 transition-colors">
            Forgot Password?
          </a>
        </div>
      </div>

      <div>
        <label for="new-password" class="block text-sm font-medium text-gray-400 mb-2">
          New Password
        </label>
        <div class="relative">
          <input 
            id="new-password" 
            name="newPassword" 
            type="password"  
            placeholder="Enter your new password"
            class="w-full px-4 py-3 bg-[#1e1e1e] border border-gray-700 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-600 focus:border-transparent text-white placeholder-gray-600 transition-all pr-10"
          >
          <button type="button" onclick="toggleVisibility('new-password', 'eye-icon-new')" class="absolute inset-y-0 right-0 z-10 flex items-center pr-3 text-gray-400 hover:text-white focus:outline-none cursor-pointer">
            <svg id="eye-icon-new" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5">
              <path stroke-linecap="round" stroke-linejoin="round" d="M2.036 12.322a1.012 1.012 0 010-.639C3.423 7.51 7.36 4.5 12 4.5c4.638 0 8.573 3.007 9.963 7.178.07.207.07.431 0 .639C20.577 16.49 16.64 19.5 12 19.5c-4.638 0-8.573-3.007-9.963-7.178z" />
              <path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
            </svg>
          </button>
        </div>
        <p id="length-message" class="text-xs text-red-500 hidden mt-1">
          Password must be at least 6 characters long.
        </p>
        <p class="text-xs text-gray-500 mt-1">
          Minimum 6 characters.
        </p>
      </div>

      <div>
        <label for="confirm-password" class="block text-sm font-medium text-gray-400 mb-2">
          Confirm New Password
        </label>
        <div class="relative">
          <input 
            id="confirm-password" 
            name="confirmPassword" 
            type="password"  
            placeholder="Confirm your new password"
            class="w-full px-4 py-3 bg-[#1e1e1e] border border-gray-700 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-600 focus:border-transparent text-white placeholder-gray-600 transition-all pr-10"
          >
          <button type="button" onclick="toggleVisibility('confirm-password', 'eye-icon-confirm')" class="absolute inset-y-0 right-0 z-10 flex items-center pr-3 text-gray-400 hover:text-white focus:outline-none cursor-pointer">
            <svg id="eye-icon-confirm" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5">
              <path stroke-linecap="round" stroke-linejoin="round" d="M2.036 12.322a1.012 1.012 0 010-.639C3.423 7.51 7.36 4.5 12 4.5c4.638 0 8.573 3.007 9.963 7.178.07.207.07.431 0 .639C20.577 16.49 16.64 19.5 12 19.5c-4.638 0-8.573-3.007-9.963-7.178z" />
              <path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
            </svg>
          </button>
        </div>
        <p id="match-message" class="text-xs text-red-500 hidden mt-1">
          Passwords do not match.
        </p>
      </div>

      <div>
        <button 
          type="submit" 
          class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-semibold py-3 px-4 rounded-lg transition-all duration-200 shadow-[0_4px_14px_0_rgba(79,70,229,0.39)] hover:shadow-[0_6px_20px_rgba(79,70,229,0.23)] hover:-translate-y-0.5"
        >
          Save Changes
        </button>
      </div>
    </form>
  </div>
</div>

<script>
  // 1. Toggle Visibility
  function toggleVisibility(inputId, iconId) {
    const input = document.getElementById(inputId);
    const icon = document.getElementById(iconId);
    
    if (!input || !icon) return;

    // SVG Paths
    const openEye = `<path stroke-linecap="round" stroke-linejoin="round" d="M2.036 12.322a1.012 1.012 0 010-.639C3.423 7.51 7.36 4.5 12 4.5c4.638 0 8.573 3.007 9.963 7.178.07.207.07.431 0 .639C20.577 16.49 16.64 19.5 12 19.5c-4.638 0-8.573-3.007-9.963-7.178z" /><path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />`;
    const closedEye = `<path stroke-linecap="round" stroke-linejoin="round" d="M3.98 8.223A10.477 10.477 0 001.934 12C3.226 16.338 7.244 19.5 12 19.5c.993 0 1.953-.138 2.863-.395M6.228 6.228A10.45 10.45 0 0112 4.5c4.756 0 8.773 3.162 10.065 7.498a10.523 10.523 0 01-4.293 5.774M6.228 6.228L3 3m3.228 3.228l3.65 3.65m7.894 7.894L21 21m-3.228-3.228l-3.65-3.65m0 0a3 3 0 10-4.243-4.243m4.242 4.242L9.88 9.88" />`;

    if (input.type === "password") {
      input.type = "text";
      icon.innerHTML = closedEye; 
    } else {
      input.type = "password";
      icon.innerHTML = openEye;   
    }
  }

  // Variables
  const form = document.getElementById('changePasswordForm');
  const newPassword = document.getElementById('new-password');
  const confirmPassword = document.getElementById('confirm-password');
  const matchMessage = document.getElementById('match-message');
  const lengthMessage = document.getElementById('length-message');

  // Input Error Helper Functions
  const showInputError = (input, messageElement) => {
    messageElement.classList.remove('hidden');
    input.classList.add('border-red-500', 'focus:ring-red-500');
    input.classList.remove('border-gray-700', 'focus:ring-indigo-600');
  };

  const clearInputError = (input, messageElement) => {
    messageElement.classList.add('hidden');
    input.classList.remove('border-red-500', 'focus:ring-red-500');
    input.classList.add('border-gray-700', 'focus:ring-indigo-600');
  };

  // 2. Length Validation
  newPassword.addEventListener('input', () => {
    // Only show error if user has typed something AND it's too short
    if (newPassword.value.length > 0 && newPassword.value.length < 6) {
      showInputError(newPassword, lengthMessage); 
    } else {
      clearInputError(newPassword, lengthMessage); 
    }
    if(confirmPassword.value) checkMatch(); 
  });

  // 3. Match Validation
  const checkMatch = () => {
    if (confirmPassword.value && newPassword.value !== confirmPassword.value) {
      showInputError(confirmPassword, matchMessage); 
      return false;
    } else {
      clearInputError(confirmPassword, matchMessage); 
      return true;
    }
  };

  confirmPassword.addEventListener('input', checkMatch);

  // 4. Form Submit Prevention
  form.addEventListener('submit', (e) => {
    let isValid = true;

    // Check Length
    if (newPassword.value.length < 6) {
      showInputError(newPassword, lengthMessage); 
      isValid = false;
    }

    // Check Match
    if (newPassword.value !== confirmPassword.value) {
      showInputError(confirmPassword, matchMessage); 
      isValid = false;
    }

    if (!isValid) {
      e.preventDefault();
    }
  });
</script>